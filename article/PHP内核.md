### php内核

#### 我们一直在使用PHP，可是他到底是怎么运行的呢，是翻译代码呢，下面我们来对这个问题进行一个简单的探讨。

从宏观上来看，PHP内核的实现与世界上绝大多数的程序一样，接收输入数据，做相应处理然后输出结果。
代码就是PHP接收的输入数据，PHP内核对我们编写的代码进行解释和运算，最后返回相应的运算结果。
PHP与我们自己平时写的一般的C程序有所不同的是， 我们的程序一般用来解决某个具体问题， 而PHP本身实现了把用户的逻辑“翻译”为机器语言来执行的功能， 这也是各种编译语言与承载具体业务逻辑的程序代码的一个明显区别。 
于是PHP就多出一个把用户代码“翻译”成具体操作的步骤：词法分析、语法分析。
当用户代码输入给PHP代码内核去执行的时候，PHP内核会对PHP代码进行词法分析和语法分析，词法分析是把PHP代码分割成一个一个单元，
语法分析是把这些单元转化成zend engine 可执行的操作。然后PHP内部的zend engine对这些操作进行顺序的执行。zend engine 是PHP内核
的核心部分，负责最终操作的执行和结果的返回，可以理解成PHP内核中的发动机。

#### PHP开始执行后会经过两个主要的阶段，处理请求之前的开始阶段和请求之后的结束阶段

#### 开始阶段有两个过程

```
第一个过程是模块初始化阶段，在整个生命周期内，该过程只进行一次。
第二个过程是模块激活阶段，该过程发生在请求阶段，例如通过url请求某个页面，则在每次请求之前都会进行模块激活（RINIT请求开始）。
第三个过程是结束阶段，一般脚本执行到末尾或者通过调用exit()或die()函数， PHP都将进入结束阶段。和开始阶段对应，结束阶段也分为两个环节，
一个在请求结束后停用模块(RSHUTDOWN，对应RINIT)， 一个在SAPI生命周期结束（Web服务器退出或者命令行脚本执行完毕退出）时关闭模块(MSHUTDOWN，对应MINIT)。
```

#### Zend引擎

Zend引擎是PHP实现的核心，提供了语言实现上的基础设施。
例如：PHP的语法实现，脚本的编译运行环境， 扩展机制以及内存管理等，
当然这里的PHP指的是官方的PHP实现(除了官方的实现， 目前比较知名的有facebook的hiphop实现，
不过到目前为止，PHP还没有一个标准的语言规范)， 而PHP则提供了请求处理和其他Web服务器的接口(SAPI)。


目前PHP的实现和Zend引擎之间的关系非常紧密，甚至有些过于紧密了，
例如很多PHP扩展都是使用的Zend API， 而Zend正是PHP语言本身的实现，
PHP只是使用Zend这个内核来构建PHP语言的，而PHP扩展大都使用Zend API， 这就导致PHP的很多扩展和Zend引擎耦合在一起了，

更多信息请查看文档[zend api](http://php.net/manual/zh/internals2.ze1.zendapi.php)